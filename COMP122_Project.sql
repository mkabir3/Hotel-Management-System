DROP TABLE COMM_EMPLOYEES CASCADE CONSTRAINTS;
DROP TABLE COMM_HOTELS CASCADE CONSTRAINTS;
DROP TABLE COMM_ROOMS CASCADE CONSTRAINTS;
DROP TABLE COMM_BOOKING CASCADE CONSTRAINTS;
DROP TABLE COMM_CUS_DETAILS CASCADE CONSTRAINTS;
DROP TABLE COMM_PAYMENT CASCADE CONSTRAINTS;

----------Creation of Tables--------------


CREATE TABLE COMM_EMPLOYEES
( EMP_ID VARCHAR2(10),
  FNAME VARCHAR2(15) NOT NULL,
  LNAME VARCHAR2(15) NOT NULL,
  ADDRESS VARCHAR2(15),
  POSTALCODE VARCHAR2(15),
  PHONE VARCHAR(15),
  EMAIL VARCHAR2(15),
  HOTEL_ID NUMBER(10),
  CONSTRAINT EMP_EMPID_PK PRIMARY KEY(EMP_ID),
  CONSTRAINT EMP_EMAIL_UK UNIQUE(EMAIL));

CREATE TABLE COMM_HOTELS
( HOTEL_ID NUMBER(10),
  NAME VARCHAR2(15),
  ADDRESS VARCHAR2(15),
  POSTALCODE VARCHAR2(15),
  PROVINCE VARCHAR2(15),
  TELEPHONE VARCHAR2(15),
  MANAGER_ID VARCHAR2(10),
  CONSTRAINT HOTELS_HOTELID_PK PRIMARY KEY(HOTEL_ID));

CREATE TABLE COMM_ROOMS
( ROOM_NO NUMBER(10),
  ROOM_TYPE VARCHAR2(15),
  ROOMDETAILS VARCHAR2(20),
  ROOMPRICE NUMBER(15,2),
  HOTEL_ID NUMBER(10),
  CONSTRAINT ROOMS_ROOMNO_PK PRIMARY KEY(ROOM_NO));

CREATE TABLE COMM_BOOKING
( BOOKING_ID NUMBER(10),
  CUSTOMER_ID NUMBER (10),
  ROOM_NO NUMBER(10),
  BOOKINGDATE DATE NOT NULL,
  CHECKIN DATE NOT NULL,
  CHECKOUT DATE NOT NULL,
  NOOFNIGHT NUMBER(15) NOT NULL,
  CONSTRAINT BOOKING_BOOKINGID_PK PRIMARY KEY(BOOKING_ID));

CREATE TABLE COMM_CUS_DETAILS
( CUSTOMER_ID NUMBER (10),
  FNAME VARCHAR2(15) NOT NULL,
  LNAME VARCHAR2(15) NOT NULL,
  DOB DATE,
  ADDRESS VARCHAR2(15),
  POSTALCODE VARCHAR2(15),
  COUNTRY VARCHAR2(15),
  PHONE VARCHAR2(15),
  EMAIL VARCHAR2(15),
  CONSTRAINT CUSDETAILS_CUSTOMERID_PK PRIMARY KEY(CUSTOMER_ID));

CREATE TABLE COMM_PAYMENT
( PAYMENT_ID NUMBER(10),
  CUSTOMER_ID NUMBER (10),
  BOOKING_ID NUMBER(10),
  CARD# VARCHAR2(15),
  EXPIREDATE DATE,
  CONSTRAINT PAYMENT_PAYMENTID_PK PRIMARY KEY(PAYMENT_ID));


---------------------------inserting data------------------------------
----------------COMM_EMPLOYEES---------------
INSERT INTO COMM_EMPLOYEES VALUES ('M-101', 'NUSRAT', 'JAHAN', 'P.O. BOX 651', 'M1M1M1', '647-111-1111', 'a@yahoo.com', 0001);
INSERT INTO COMM_EMPLOYEES VALUES ('T-102', 'ROJINA', 'AKTER', 'P.O. BOX 581', 'M2M2M2', '647-222-2222', 'b@yahoo.com', 0006);
INSERT INTO COMM_EMPLOYEES VALUES ('S-103', 'SMITH', 'LEILA', 'P.O. BOX 234', 'M3M3M3', '647-333-3333', 'c@yahoo.com', 0004);
INSERT INTO COMM_EMPLOYEES VALUES ('P-104', 'PIERSON', 'THOMAS', 'P.O. BOX 925', 'M4M4M4', '647-444-4444', 'd@yahoo.com', 0001);
INSERT INTO COMM_EMPLOYEES VALUES ('G-105', 'GIRARD', 'CINDY', 'P.O. BOX 652', 'M5M5M5', '647-555-5555', 'e@yahoo.com', 0001);
INSERT INTO COMM_EMPLOYEES VALUES ('C-106', 'CRUZ', 'MESHIA', 'P.O. BOX 787', 'M6M6M6', '647-666-6666', 'f@yahoo.com', 0007);
INSERT INTO COMM_EMPLOYEES VALUES ('S-107', 'SHILA', 'DESHAI', 'P.O. BOX 678', 'M6M3M4', '647-777-7777', 'g@yahoo.com', 0002);
INSERT INTO COMM_EMPLOYEES VALUES ('P-108', 'KIM', 'THOMPSON', 'P.O. BOX 454', 'M4M4M1', '647-888-8888', 'h@yahoo.com', 0002);
INSERT INTO COMM_EMPLOYEES VALUES ('G-109', 'LILY', 'MISTRA', 'P.O. BOX 786', 'M5M7M5', '647-999-9999', 'i@yahoo.com', 0001);
INSERT INTO COMM_EMPLOYEES VALUES ('C-110', 'SULTANA', 'AMIR', 'P.O. BOX 255', 'M4M6M6', '647-101-1010', 'j@yahoo.com', 0003);
INSERT INTO COMM_EMPLOYEES VALUES ('P-111', 'ROJ', 'THOMAS', 'P.O. BOX 454', 'M4M4M1', '647-888-8888', 'k@yahoo.com', 0002);
INSERT INTO COMM_EMPLOYEES VALUES ('G-112', 'LAILA', 'AHMED', 'P.O. BOX 786', 'M5M7M5', '647-999-9999', 'l@yahoo.com', 0001);
INSERT INTO COMM_EMPLOYEES VALUES ('C-113', 'SULTAN', 'KHAN', 'P.O. BOX 255', 'M4M6M6', '647-101-1010', 'm@yahoo.com', 0003);

-----------------COMM_HOTELS--------------------
INSERT INTO COMM_HOTELS VALUES (0001, 'SWEET DREAMS', '565 SHER ST', 'M4X1W7', 'ONTARIO', '000-123-5478', 'M-9000');
INSERT INTO COMM_HOTELS VALUES (0002, 'Holiday Inn', '575 VIC ST', 'M4X1W7', 'ONTARIO', '000-123-7896', 'M-8000');
INSERT INTO COMM_HOTELS VALUES (0003, 'Quality Inn', '555 FINCH ST', 'M4X1W7', 'ONTARIO', '000-123-1234', 'M-7000');
INSERT INTO COMM_HOTELS VALUES (0004, 'Sheraton', '595 KENEDY ST', 'M4X1W7', 'ONTARIO', '000-123-5932', 'M-6000');
INSERT INTO COMM_HOTELS VALUES (0005, 'Toronto Inn', '466 WARDEN ST', 'M4X1W7', 'ONTARIO', '000-123-5467', 'M-1000');
INSERT INTO COMM_HOTELS VALUES (0006, 'Holiday Inn', '567 VILL ST', 'M4X1W7', 'ONTARIO', '000-123-7864', 'M-3000');
INSERT INTO COMM_HOTELS VALUES (0007, 'Sea Gull', '546 UNION ST', 'M4Y1W7', 'ONTARIO', '000-123-7567', 'M-2000');
INSERT INTO COMM_HOTELS VALUES (0008, 'Shonargao', '675 BLOOR ST', 'M3X1W7', 'ONTARIO', '000-123-4645', 'M-4000');
INSERT INTO COMM_HOTELS VALUES (0009, 'Hotel Paradise', '456 FINCH ST', 'M4X9W7', 'ONTARIO', '000-123-5475', 'M-5000');
INSERT INTO COMM_HOTELS VALUES (0010, 'Danforth Inn', '786 UNION ST', 'M4X1W8', 'ONTARIO', '000-123-2434', 'M-1100'); 

------------------COMM_ROOMS---------------------
INSERT INTO COMM_ROOMS VALUES (101, 'SINGLE', 'MAX 2 ALLOWED', 200, 0002);
INSERT INTO COMM_ROOMS VALUES (302, 'SINGLE', 'MAX 2 ALLOWED', 250, 0008);
INSERT INTO COMM_ROOMS VALUES (701, 'SINGLE', 'MAX 2 ALLOWED', 200, 0001);
INSERT INTO COMM_ROOMS VALUES (408, 'DOUBLE', 'MAX 4 ALLOWED', 400, 0003);
INSERT INTO COMM_ROOMS VALUES (905, 'DOUBLE', 'MAX 4 ALLOWED', 300, 0002);
INSERT INTO COMM_ROOMS VALUES (710, 'FAMILY', 'MAX 6 ALLOWED', 550, 0006);
INSERT INTO COMM_ROOMS VALUES (609, 'DELUX', 'MAX 6 ALLOWED', 650, 0008);
INSERT INTO COMM_ROOMS VALUES (403, 'FAMILY', 'MAX 6 ALLOWED', 550, 0003);
INSERT INTO COMM_ROOMS VALUES (1005, 'BUSINESS', 'MAX 10 ALLOWED', 700,0010);
INSERT INTO COMM_ROOMS VALUES (456, 'BUSINESS', 'MAX 10 ALLOWED', 800,0002);

-----------------COMM_BOOKING-------------------------
INSERT INTO COMM_BOOKING VALUES (1602001, 161007, 1005, To_Date('07-JAN-2018','dd-mm-yy'), '10-FEB-2018', '15-FEB-18', 5);
INSERT INTO COMM_BOOKING VALUES (1602002, 161002, 302, To_Date('10-FEB-2018','dd-mm-yy'), '10-MAR-18', '20-MAR-18', 10);
INSERT INTO COMM_BOOKING VALUES (1602003, 161006, 710, To_Date('12-MAR-2018','dd-mm-yy'), '05-APR-18', '08-APR-18',3);
INSERT INTO COMM_BOOKING VALUES (1602004, 161010, 701, To_Date('15- MAR -2018','dd-mm-yy'), '10-APR-18', '16- APR -18', 6);
INSERT INTO COMM_BOOKING VALUES (1602005, 161004, 609, To_Date('10- APR -2018','dd-mm-yy'), '20- APR -18', '30- APR -18', 10);
INSERT INTO COMM_BOOKING VALUES (1602006, 161003, 905, To_Date('21- APR -2018','dd-mm-yy'), '10-MAY-2018', '13-FEB-18',3);
INSERT INTO COMM_BOOKING VALUES (1602007, 161005, 403, To_Date('10-MAY-2018','dd-mm-yy'), '22-MAY-18', '27-MAY-18', 5);
INSERT INTO COMM_BOOKING VALUES (1602008, 161008, 403, To_Date('10-MAY-2018','dd-mm-yy'), '10-JUN-18', '14-JUN-18',4);
INSERT INTO COMM_BOOKING VALUES (1602009, 161001, 701, To_Date('01-JUN-2018','dd-mm-yy'), '10-JUN-18', '18-JUNE-17', 8);
INSERT INTO COMM_BOOKING VALUES (1602010, 161009, 456, To_Date('10-JUN-2018','dd-mm-yy'), '28-JUN-18', '04-JUL-18', 7);
INSERT INTO COMM_BOOKING VALUES (1602011, 161005, 403, To_Date('10-MAY-2018','dd-mm-yy'), '02-JUL-18', '07-JUL-18', 5);
INSERT INTO COMM_BOOKING VALUES (1602012, 161003, 905, To_Date('25-JUN-2018','dd-mm-yy'), '10-JUL-18', '14-JUL-18',4);
INSERT INTO COMM_BOOKING VALUES (1602013, 161002, 701, To_Date('01-JUN-2018','dd-mm-yy'), '10-JUL-18', '18-JUL-18', 8);
INSERT INTO COMM_BOOKING VALUES (1602014, 161006, 456, To_Date('24-JUN-2018','dd-mm-yy'), '28-JUL-18', '05-AUG-18', 9);

---------------------COMM_CUS_DETAILS--------------------------
INSERT INTO COMM_CUS_DETAILS VALUES (161001, 'ADAM', 'HECK', TO_DATE('26-MARCH-1992', 'DD-MM-YY'), '10 VICTORIA', 'M3J1W7', 'CANADA', '647-111-1111', 'ad@yahoo.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161002, 'DAVID', 'DSUZA', TO_DATE('6-MAY-1990', 'DD-MM-YY'), '20 VICTORIA', 'M3J1W7', 'CANADA', '416-222-2222', 'da@gmail.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161003, 'BARAK', 'OBAMA', TO_DATE('2-JUNE-1972','DD-MM-YY'), '10 DC', 'M-2500', 'USA', '816-333-3333', 'ba@gmail.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161004, 'HILARY', 'CLINTON', TO_DATE('21-JAN-1962','DD-MM-YY'), '103 LOS ANGELS', 'L-2010', 'USA', '816-444-4444', 'hi@yahoo.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161005, 'BOB', 'PATRICK', TO_DATE('10-MARCH-1976','DD-MM-YY'), '10 BAY ', 'M3J5Y6', 'CANADA', '647-555-5555', 'bo@yahoo.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161006, 'YUNUS', 'MIAH', TO_DATE('3-FEB-1979','DD-MM-YY'), '15 VICTORIA', 'M3J1W7', 'CANADA', '416-666-6666', 'yu@gmail.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161007, 'DONALD', 'TRUMP', TO_DATE('12-DEC-1962','DD-MM-YY'), '10 MANHATAN', 'N-2500', 'USA', '816-777-8888', 'do@gmail.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161008, 'ROJINA', 'AKTER', TO_DATE('10-MARCH-1976','DD-MM-YY'), '10 BAY ', 'M3J5Y6', 'CANADA', '647-555-4555', 'ro@yahoo.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161009, 'IBRAHIM', 'KHAN', TO_DATE('3-FEB-1979','DD-MM-YY'), '15 VICTORIA', 'M3J1W7', 'CANADA', '416-666-6356', 'ib@gmail.com');
INSERT INTO COMM_CUS_DETAILS VALUES (161010, 'NUSRAT', 'JAHAN', TO_DATE('12-DEC-1962','DD-MM-YY'), '10 MANHATAN', 'N-2500', 'USA', '816-777-8458', 'nu@yahoo.com');

--------------------COMM_PAYMENT--------------------------------
INSERT INTO COMM_PAYMENT VALUES (98745621, 161004, 1602005, '547-895-6541', To_Date('10-MAY-2019','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (92136547, 161006, 1602003, '547-523-3215', To_Date('10-JUN-2021','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (93547865, 161007, 1602001, '215-965-4156', To_Date('10-JUL-2021','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (96587413, 161002, 1602004, '798-825-1251', To_Date('10-AUG-2019','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (98745622, 161008, 1602002, '547-895-6540', To_Date('15-APR-2020','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (92136548, 161005, 1602006, '547-523-3267', To_Date('11-OCT-2018','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (93547823, 161003, 1602010, '215-965-4134', To_Date('10-DEC-2018','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (96587424, 161001, 1602007, '798-825-1250', To_Date('04-AUG-2019','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (98745625, 161009, 1602009, '547-895-6571', To_Date('20-MAY-2021','dd-mm-yy'));
INSERT INTO COMM_PAYMENT VALUES (92136526, 161010, 1602008, '547-523-5657', To_Date('10-DEC-2018','dd-mm-yy'));

-------------------------------------------Constraints---------------------------------------------
ALTER TABLE COMM_EMPLOYEES ADD CONSTRAINT HOTELS_HOTELID_FK FOREIGN KEY(HOTEL_ID) REFERENCES COMM_HOTELS(HOTEL_ID); 
ALTER TABLE COMM_ROOMS ADD CONSTRAINT ROOMS_HOTELID_FK FOREIGN KEY(HOTEL_ID) REFERENCES COMM_HOTELS(HOTEL_ID);
ALTER TABLE COMM_BOOKING ADD CONSTRAINT BOOKING_CUSTOMERID_FK FOREIGN KEY(CUSTOMER_ID) REFERENCES COMM_CUS_DETAILS(CUSTOMER_ID);
ALTER TABLE COMM_BOOKING ADD CONSTRAINT BOOKING_ROOMNO_FK FOREIGN KEY(ROOM_NO) REFERENCES COMM_ROOMS(ROOM_NO);
ALTER TABLE COMM_CUS_DETAILS ADD CONSTRAINT CUSDETAILS_EMAIL_UK UNIQUE(EMAIL);
ALTER TABLE COMM_PAYMENT ADD CONSTRAINT PAYMENT_CUSID_FK FOREIGN KEY(CUSTOMER_ID) REFERENCES COMM_CUS_DETAILS(CUSTOMER_ID);
ALTER TABLE COMM_PAYMENT ADD CONSTRAINT PAYMENT_BOOKINGID_FK FOREIGN KEY(BOOKING_ID) REFERENCES COMM_BOOKING(BOOKING_ID);

------------------------------------Showing tables---------------------------------
SELECT * FROM COMM_EMPLOYEES;
SELECT * FROM COMM_HOTELS;
SELECT * FROM COMM_ROOMS;
SELECT * FROM COMM_BOOKING;
SELECT * FROM COMM_CUS_DETAILS;
SELECT * FROM COMM_PAYMENT;

---------------------------------Queries--------------------------------------------------------

----------query 01----------
SELECT E.FNAME || ' ' || E.LNAME AS "EMPLOYEE NAME", H.NAME, R.ROOM_TYPE, B.BOOKING_ID, B.BOOKINGDATE, P.CUSTOMER_ID 
FROM COMM_EMPLOYEES E, COMM_HOTELS H, COMM_ROOMS R, COMM_BOOKING B, COMM_PAYMENT P
WHERE E.HOTEL_ID = H.HOTEL_ID AND H.HOTEL_ID = R.HOTEL_ID AND R.ROOM_NO = B.ROOM_NO AND B.CUSTOMER_ID = P.CUSTOMER_ID;

-------------query 02-----------
SELECT E.EMP_ID, E.FNAME, E.LNAME, E.ADDRESS,H.NAME, B.BOOKING_ID, C.FNAME|| ' ' ||C.LNAME AS "CUSTOMER_NAME",
C.COUNTRY FROM COMM_EMPLOYEES E 
JOIN COMM_HOTELS H USING(HOTEL_ID)
JOIN COMM_ROOMS R USING (HOTEL_ID)
JOIN COMM_BOOKING B USING (ROOM_NO)
JOIN COMM_CUS_DETAILS C USING (CUSTOMER_ID)
WHERE E.PHONE LIKE '%6%' AND E.ADDRESS BETWEEN 'P.O. BOX 500' AND 'P.O. BOX 700';

-------------query 03-----------
SELECT C.FNAME ||' ' || C.LNAME AS "NEW NAME", B.BOOKINGDATE, B.CHECKIN, B.CHECKOUT, P.CARD#,R.ROOMDETAILS,R.ROOMPRICE
FROM COMM_CUS_DETAILS C JOIN COMM_PAYMENT P USING (CUSTOMER_ID)
JOIN COMM_BOOKING B USING (CUSTOMER_ID) JOIN COMM_ROOMS R USING (ROOM_NO) 
WHERE B.BOOKINGDATE BETWEEN '01-JAN-2018' AND '30-MAR-2018' ORDER BY R.ROOMPRICE;

-------------query 04-----------
SELECT C.FNAME || ' ' || C.LNAME AS "CUSTOMER NAME", C.COUNTRY, P.PAYMENT_ID, B.CHECKIN, B.CHECKOUT, ROOM_TYPE, R.ROOMPRICE
FROM COMM_CUS_DETAILS C
INNER JOIN COMM_PAYMENT P USING (CUSTOMER_ID)
INNER JOIN COMM_BOOKING B USING (CUSTOMER_ID) 
INNER JOIN COMM_ROOMS R USING (ROOM_NO);

-------------query 05-----------
SELECT FNAME, LNAME, COUNTRY, BOOKINGDATE, NOOFNIGHT 
FROM COMM_CUS_DETAILS CROSS JOIN COMM_BOOKING ORDER BY 2 DESC;

-------------query 06-----------
SELECT CUSTOMER_ID, FNAME || ' ' ||LNAME AS "CUSTOMER NAME", COUNTRY 
FROM COMM_CUS_DETAILS WHERE COUNTRY IN ('USA','CANADA') ORDER BY COUNTRY;

-------------query 07-----------
SELECT C.FNAME || ' ' || C.LNAME AS "CUSTOMER NAME", C.COUNTRY, C.PHONE, P.PAYMENT_ID, ROOM_TYPE, 
R.ROOMPRICE * B.NOOFNIGHT AS RENT_PAID
 FROM COMM_CUS_DETAILS C
 JOIN COMM_PAYMENT P USING (CUSTOMER_ID)
 JOIN COMM_BOOKING B USING (CUSTOMER_ID) 
JOIN COMM_ROOMS R USING (ROOM_NO) ORDER BY COUNTRY;

-------------query 08-----------
SELECT DISTINCT ROOMDETAILS FROM COMM_ROOMS;

-------------query 09-----------
SELECT FNAME, LNAME, REPLACE(ADDRESS,'P.O. BOX') AS ADDRESS 
FROM COMM_CUS_DETAILS WHERE COUNTRY = 'CANADA';

-------------query 10-----------
SELECT C.FNAME, C.LNAME, C.COUNTRY, B.BOOKINGDATE, B.NOOFNIGHT 
FROM COMM_CUS_DETAILS C 
JOIN COMM_BOOKING B USING (CUSTOMER_ID) WHERE B.BOOKINGDATE
BETWEEN '01-JAN-2018' AND '30-APR-2018';

-------------query 11-----------
ALTER TABLE COMM_HOTELS ADD CONSTRAINT HOTELS_HOTELID_CK CHECK (HOTEL_ID > 0);

-------------query 12-----------
SELECT C.FNAME,C.LNAME,B.BOOKING_ID,R.ROOM_TYPE,B.BOOKINGDATE 
FROM COMM_ROOMS R 
JOIN COMM_BOOKING B USING(ROOM_NO)
JOIN COMM_CUS_DETAILS C USING(CUSTOMER_ID);

-------------query 13-----------
SELECT * FROM COMM_CUS_DETAILS 
WHERE CUSTOMER_ID = (SELECT CUSTOMER_ID FROM COMM_CUS_DETAILS WHERE LNAME = 'DSUZA');

-------------query 14-----------
SELECT H.NAME,H.ADDRESS,R.ROOMDETAILS,B.BOOKINGDATE,C.FNAME|| ' ' ||C.LNAME AS "CUSTOMER NAME",C.COUNTRY
FROM COMM_HOTELS H 
JOIN COMM_ROOMS R USING(HOTEL_ID) 
JOIN COMM_BOOKING B USING(ROOM_NO) 
JOIN COMM_CUS_DETAILS C USING(CUSTOMER_ID)
WHERE C.FNAME = 'ROJINA' OR C.FNAME = 'DONALD' OR C.FNAME = 'NUSRAT';

